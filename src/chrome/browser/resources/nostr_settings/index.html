<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nostr Settings</title>
  <link rel="stylesheet" href="chrome://resources/css/chrome_shared.css">
  <link rel="stylesheet" href="nostr_settings.css">
  <script src="chrome://resources/js/cr.js"></script>
  <script src="chrome://resources/js/promise_resolver.js"></script>
  <script src="chrome://resources/js/util.js"></script>
  <script src="account_manager.js"></script>
  <script src="permission_manager.js"></script>
  <script src="relay_settings_manager.js"></script>
  <script src="blossom_settings_manager.js"></script>
  <script src="nostr_settings.js"></script>
</head>
<body>
  <div class="settings-container">
    <h1>Nostr Settings</h1>
    
    <nav class="settings-nav">
      <button class="nav-button" data-section="accounts">Accounts</button>
      <button class="nav-button" data-section="permissions">Permissions</button>
      <button class="nav-button" data-section="local-relay">Local Relay</button>
      <button class="nav-button" data-section="blossom">Blossom Storage</button>
      <button class="nav-button" data-section="security">Security</button>
    </nav>
    
    <div class="settings-content">
      <!-- Accounts Section -->
      <section id="accounts" class="settings-section">
        <h2>Nostr Accounts</h2>
        <div class="section-content">
          <div class="setting-item">
            <p>Manage your Nostr identities and switch between accounts</p>
            
            <!-- Current Account Display -->
            <div id="current-account" class="current-account-display" hidden>
              <h3>Active Account</h3>
              <div class="current-account-info">
                <div class="account-avatar">
                  <img id="current-account-avatar" src="" alt="Avatar">
                  <div class="avatar-placeholder" id="current-account-placeholder">N</div>
                </div>
                <div class="account-details">
                  <div id="current-account-name" class="account-name"></div>
                  <div id="current-account-pubkey" class="account-pubkey"></div>
                  <div id="current-account-nip05" class="account-nip05"></div>
                </div>
              </div>
            </div>
            
            <!-- Accounts List -->
            <h3>All Accounts</h3>
            <div id="accounts-list" class="accounts-list"></div>
            
            <!-- Account Actions -->
            <div class="account-actions-container">
              <button id="add-account-button" class="primary-button">
                <span class="icon">+</span> Create New Account
              </button>
              <button id="import-account-button" class="secondary-button">
                <span class="icon">⬇</span> Import Account
              </button>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Account Creation Wizard -->
      <dialog id="account-creation-dialog" class="account-dialog">
        <div class="dialog-header">
          <h2>Create New Account</h2>
          <button class="close-button" id="close-creation-dialog">×</button>
        </div>
        <div class="wizard-steps">
          <div class="step active" data-step="1">1. Generate Keys</div>
          <div class="step" data-step="2">2. Profile Setup</div>
          <div class="step" data-step="3">3. Backup Keys</div>
        </div>
        <div class="dialog-content">
          <!-- Step 1: Key Generation -->
          <div id="step-1" class="wizard-step active">
            <h3>Generate Your Nostr Keys</h3>
            <p>Your keys are your identity on Nostr. Keep them safe!</p>
            <div class="key-display">
              <div class="key-field">
                <label>Public Key (npub)</label>
                <div class="key-value" id="generated-npub"></div>
                <button class="copy-button" data-copy="generated-npub">Copy</button>
              </div>
              <div class="key-field">
                <label>Private Key (nsec) - Keep this secret!</label>
                <div class="key-value masked" id="generated-nsec">
                  <span class="masked-content">••••••••••••••••••••</span>
                </div>
                <button class="toggle-visibility" data-target="generated-nsec">Show</button>
                <button class="copy-button" data-copy="generated-nsec">Copy</button>
              </div>
            </div>
            <div class="warning-box">
              <strong>⚠️ Important:</strong> Save your private key somewhere safe. 
              If you lose it, you cannot recover your account!
            </div>
          </div>
          
          <!-- Step 2: Profile Setup -->
          <div id="step-2" class="wizard-step" hidden>
            <h3>Set Up Your Profile</h3>
            <div class="form-group">
              <label for="account-name">Display Name</label>
              <input type="text" id="account-name" placeholder="Enter your display name">
            </div>
            <div class="form-group">
              <label for="account-about">About</label>
              <textarea id="account-about" rows="3" placeholder="Tell something about yourself"></textarea>
            </div>
            <div class="form-group">
              <label for="account-picture">Picture URL (optional)</label>
              <input type="url" id="account-picture" placeholder="https://example.com/avatar.jpg">
            </div>
            <div class="form-group">
              <label for="account-nip05">NIP-05 Identifier (optional)</label>
              <input type="text" id="account-nip05" placeholder="name@example.com">
            </div>
          </div>
          
          <!-- Step 3: Backup -->
          <div id="step-3" class="wizard-step" hidden>
            <h3>Backup Your Keys</h3>
            <p>Choose how you want to backup your keys:</p>
            <div class="backup-options">
              <label class="backup-option">
                <input type="checkbox" id="backup-downloaded">
                <span>Download encrypted backup file</span>
              </label>
              <label class="backup-option">
                <input type="checkbox" id="backup-written">
                <span>I have written down my private key</span>
              </label>
              <label class="backup-option">
                <input type="checkbox" id="backup-password-manager">
                <span>I have saved it in my password manager</span>
              </label>
            </div>
            <div class="qr-code-container" hidden>
              <h4>QR Code (Private Key)</h4>
              <canvas id="nsec-qr-code"></canvas>
            </div>
          </div>
        </div>
        <div class="dialog-footer">
          <button id="wizard-back" class="secondary-button" hidden>Back</button>
          <button id="wizard-next" class="primary-button">Next</button>
          <button id="wizard-finish" class="primary-button" hidden>Create Account</button>
        </div>
      </dialog>
      
      <!-- Import Account Dialog -->
      <dialog id="import-account-dialog" class="account-dialog">
        <div class="dialog-header">
          <h2>Import Account</h2>
          <button class="close-button" id="close-import-dialog">×</button>
        </div>
        <div class="dialog-content">
          <p>Import an existing Nostr account using your private key</p>
          <div class="import-tabs">
            <button class="tab-button active" data-tab="text">Text</button>
            <button class="tab-button" data-tab="file">File</button>
            <button class="tab-button" data-tab="qr">QR Code</button>
          </div>
          
          <!-- Text Import -->
          <div id="import-text" class="import-panel active">
            <div class="form-group">
              <label for="import-nsec">Private Key (nsec or hex)</label>
              <input type="password" id="import-nsec" placeholder="nsec1..." autocomplete="off">
              <button class="toggle-visibility" data-target="import-nsec">Show</button>
            </div>
          </div>
          
          <!-- File Import -->
          <div id="import-file" class="import-panel" hidden>
            <div class="form-group">
              <label for="import-file-input">Select backup file</label>
              <input type="file" id="import-file-input" accept=".json,.txt">
              <p class="help-text">Supports encrypted backup files from Tungsten or other Nostr clients</p>
            </div>
            <div class="form-group" id="file-password-group" hidden>
              <label for="import-file-password">File Password</label>
              <input type="password" id="import-file-password" placeholder="Enter password">
            </div>
          </div>
          
          <!-- QR Import -->
          <div id="import-qr" class="import-panel" hidden>
            <div class="qr-scanner">
              <video id="qr-video" hidden></video>
              <canvas id="qr-canvas"></canvas>
              <button id="start-qr-scan" class="primary-button">Start Camera</button>
            </div>
          </div>
          
          <div class="warning-box">
            <strong>Security Note:</strong> Your private key will be encrypted and stored securely in your browser.
          </div>
        </div>
        <div class="dialog-footer">
          <button id="cancel-import" class="secondary-button">Cancel</button>
          <button id="confirm-import" class="primary-button">Import Account</button>
        </div>
      </dialog>
      
      <!-- Account Switch Dialog -->
      <dialog id="switch-account-dialog" class="account-dialog compact">
        <div class="dialog-header">
          <h3>Switch Account</h3>
          <button class="close-button" id="close-switch-dialog">×</button>
        </div>
        <div class="dialog-content">
          <div id="switch-accounts-list" class="switch-accounts-list"></div>
        </div>
      </dialog>
      
      <!-- Permissions Section -->
      <section id="permissions" class="settings-section" hidden>
        <h2>Site Permissions</h2>
        <div class="section-content">
          <div class="setting-item">
            <p>Control which sites can access your Nostr identity and operations</p>
            
            <!-- Permission Controls -->
            <div class="permission-controls-bar">
              <div class="permission-search">
                <input type="text" id="permission-search" placeholder="Search sites..." class="search-input">
              </div>
              <div class="permission-actions">
                <button id="bulk-permissions-button" class="secondary-button">Bulk Actions</button>
                <button id="add-permission-button" class="secondary-button">Add Site</button>
                <button id="clear-all-permissions" class="danger-button">Clear All</button>
              </div>
            </div>
            
            <!-- Permission Summary -->
            <div class="permission-summary">
              <div class="permission-stat">
                <span class="stat-number" id="total-sites">0</span>
                <span class="stat-label">Sites</span>
              </div>
              <div class="permission-stat">
                <span class="stat-number" id="allowed-sites">0</span>
                <span class="stat-label">Allowed</span>
              </div>
              <div class="permission-stat">
                <span class="stat-number" id="blocked-sites">0</span>
                <span class="stat-label">Blocked</span>
              </div>
              <div class="permission-stat">
                <span class="stat-number" id="ask-sites">0</span>
                <span class="stat-label">Ask</span>
              </div>
            </div>
            
            <!-- Permissions List -->
            <div id="permissions-list" class="permissions-list">
              <div class="permissions-empty" id="permissions-empty">
                <div class="empty-icon">🔒</div>
                <h3>No Site Permissions</h3>
                <p>Sites you visit will appear here when they request Nostr permissions</p>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Permission Edit Dialog -->
      <dialog id="permission-edit-dialog" class="permission-dialog">
        <div class="dialog-header">
          <h2>Edit Site Permissions</h2>
          <button class="close-button" id="close-permission-dialog">×</button>
        </div>
        <div class="dialog-content">
          <div class="permission-site-info">
            <div class="site-icon" id="permission-site-icon">🌐</div>
            <div class="site-details">
              <h3 id="permission-site-name"></h3>
              <p id="permission-site-origin"></p>
            </div>
          </div>
          
          <!-- General Permissions -->
          <div class="permission-section">
            <h4>General Access</h4>
            <div class="permission-setting">
              <label>Default Policy</label>
              <select id="default-policy">
                <option value="ask">Ask each time</option>
                <option value="allow">Always allow</option>
                <option value="deny">Always deny</option>
              </select>
            </div>
          </div>
          
          <!-- Method Permissions -->
          <div class="permission-section">
            <h4>Method Permissions</h4>
            <div class="method-permissions">
              <div class="permission-method">
                <label>
                  <span class="method-name">Get Public Key</span>
                  <span class="method-description">Read your public identity</span>
                </label>
                <select data-method="getPublicKey">
                  <option value="default">Use default</option>
                  <option value="allow">Allow</option>
                  <option value="deny">Deny</option>
                  <option value="ask">Ask</option>
                </select>
              </div>
              
              <div class="permission-method">
                <label>
                  <span class="method-name">Sign Events</span>
                  <span class="method-description">Create signed messages</span>
                </label>
                <select data-method="signEvent">
                  <option value="default">Use default</option>
                  <option value="allow">Allow</option>
                  <option value="deny">Deny</option>
                  <option value="ask">Ask</option>
                </select>
              </div>
              
              <div class="permission-method">
                <label>
                  <span class="method-name">Get Relays</span>
                  <span class="method-description">Read relay configuration</span>
                </label>
                <select data-method="getRelays">
                  <option value="default">Use default</option>
                  <option value="allow">Allow</option>
                  <option value="deny">Deny</option>
                  <option value="ask">Ask</option>
                </select>
              </div>
              
              <div class="permission-method">
                <label>
                  <span class="method-name">NIP-04 Encrypt</span>
                  <span class="method-description">Encrypt private messages</span>
                </label>
                <select data-method="nip04.encrypt">
                  <option value="default">Use default</option>
                  <option value="allow">Allow</option>
                  <option value="deny">Deny</option>
                  <option value="ask">Ask</option>
                </select>
              </div>
              
              <div class="permission-method">
                <label>
                  <span class="method-name">NIP-04 Decrypt</span>
                  <span class="method-description">Decrypt private messages</span>
                </label>
                <select data-method="nip04.decrypt">
                  <option value="default">Use default</option>
                  <option value="allow">Allow</option>
                  <option value="deny">Deny</option>
                  <option value="ask">Ask</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Event Kind Permissions -->
          <div class="permission-section">
            <h4>Event Kind Permissions</h4>
            <p class="section-description">Control which types of events this site can create</p>
            <div class="kind-permissions">
              <div class="kind-presets">
                <button class="preset-button" data-preset="social">Social Media</button>
                <button class="preset-button" data-preset="messaging">Messaging</button>
                <button class="preset-button" data-preset="custom">Custom</button>
              </div>
              <div class="kind-matrix" id="kind-matrix">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
          </div>
          
          <!-- Rate Limits -->
          <div class="permission-section">
            <h4>Rate Limits</h4>
            <div class="rate-limit-settings">
              <div class="rate-limit-setting">
                <label for="requests-per-minute">Requests per minute</label>
                <input type="number" id="requests-per-minute" min="1" max="300" value="60">
              </div>
              <div class="rate-limit-setting">
                <label for="signs-per-hour">Signs per hour</label>
                <input type="number" id="signs-per-hour" min="1" max="1000" value="20">
              </div>
            </div>
          </div>
          
          <!-- Expiration -->
          <div class="permission-section">
            <h4>Permission Expiration</h4>
            <div class="expiration-settings">
              <label>
                <input type="radio" name="expiration" value="never" checked>
                <span>Never expire</span>
              </label>
              <label>
                <input type="radio" name="expiration" value="session">
                <span>End of session</span>
              </label>
              <label>
                <input type="radio" name="expiration" value="custom">
                <span>Custom duration:</span>
              </label>
              <div class="custom-expiration" id="custom-expiration" style="display: none;">
                <input type="number" id="expiration-days" min="1" max="365" value="30">
                <span>days</span>
              </div>
            </div>
          </div>
        </div>
        <div class="dialog-footer">
          <button id="reset-permission" class="danger-button">Reset to Default</button>
          <div class="dialog-actions">
            <button id="cancel-permission-edit" class="secondary-button">Cancel</button>
            <button id="save-permission-edit" class="primary-button">Save Changes</button>
          </div>
        </div>
      </dialog>
      
      <!-- Bulk Actions Dialog -->
      <dialog id="bulk-actions-dialog" class="permission-dialog compact">
        <div class="dialog-header">
          <h3>Bulk Permission Actions</h3>
          <button class="close-button" id="close-bulk-dialog">×</button>
        </div>
        <div class="dialog-content">
          <div class="bulk-actions">
            <button class="bulk-action-button" data-action="allow-all">
              <span class="action-icon">✓</span>
              <span>Allow All Sites</span>
            </button>
            <button class="bulk-action-button" data-action="deny-all">
              <span class="action-icon">✕</span>
              <span>Deny All Sites</span>
            </button>
            <button class="bulk-action-button" data-action="reset-all">
              <span class="action-icon">↺</span>
              <span>Reset All to Ask</span>
            </button>
            <button class="bulk-action-button danger" data-action="clear-all">
              <span class="action-icon">🗑</span>
              <span>Clear All Permissions</span>
            </button>
          </div>
        </div>
      </dialog>
      
      <!-- Local Relay Section -->
      <section id="local-relay" class="settings-section" hidden>
        <h2>Local Relay</h2>
        <div class="section-content">
          <div class="setting-item">
            <div class="relay-header">
              <div class="relay-enable-controls">
                <label>
                  <input type="checkbox" id="relay-enabled">
                  <span>Enable local relay</span>
                </label>
                <div class="relay-status" id="relay-status">
                  <span class="status-indicator" id="relay-status-indicator">●</span>
                  <span class="status-text" id="relay-status-text">Stopped</span>
                </div>
              </div>
              <div class="relay-address" id="relay-address" hidden>
                <span class="address-label">Address:</span>
                <span class="address-value" id="relay-address-value">ws://127.0.0.1:8081</span>
                <button class="copy-button" id="copy-relay-address">Copy</button>
              </div>
            </div>
          </div>
          
          <div class="relay-settings" id="relay-settings">
            
            <!-- Current Status & Statistics -->
            <div class="relay-stats" id="relay-stats" hidden>
              <h3>Current Status</h3>
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">Connections</span>
                  <span class="stat-value" id="stat-connections">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Total Events</span>
                  <span class="stat-value" id="stat-events">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Storage Used</span>
                  <span class="stat-value" id="stat-storage">0 MB</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Uptime</span>
                  <span class="stat-value" id="stat-uptime">0m</span>
                </div>
              </div>
            </div>
            
            <!-- Network Configuration -->
            <div class="settings-group">
              <h3>Network Configuration</h3>
              <div class="setting-item">
                <label for="relay-port">Port</label>
                <div class="input-with-validation">
                  <input type="number" id="relay-port" min="1024" max="65535" value="8081">
                  <div class="validation-message" id="port-validation"></div>
                </div>
                <div class="setting-description">Port number for WebSocket connections (1024-65535)</div>
              </div>
              
              <div class="setting-item">
                <label for="relay-interface">Interface</label>
                <div class="input-with-validation">
                  <select id="relay-interface">
                    <option value="127.0.0.1">Localhost only (127.0.0.1)</option>
                    <option value="0.0.0.0">All interfaces (0.0.0.0)</option>
                  </select>
                  <div class="validation-message" id="interface-validation"></div>
                </div>
                <div class="setting-description">Network interface to bind to</div>
              </div>
              
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="relay-external">
                  <span>Allow external connections</span>
                </label>
                <div class="setting-description">Enable access from other devices on the network</div>
              </div>
              
              <div class="setting-item">
                <label for="relay-max-connections">Max Connections</label>
                <div class="slider-input">
                  <input type="range" id="relay-max-connections" min="10" max="1000" value="100" class="slider">
                  <input type="number" id="relay-max-connections-value" min="10" max="1000" value="100" class="slider-value">
                </div>
                <div class="setting-description">Maximum concurrent WebSocket connections</div>
              </div>
            </div>
            
            <!-- Storage Configuration -->
            <div class="settings-group">
              <h3>Storage Configuration</h3>
              <div class="setting-item">
                <label for="relay-storage">Storage Limit</label>
                <div class="slider-input">
                  <input type="range" id="relay-storage" min="0.1" max="50" step="0.1" value="1" class="slider">
                  <input type="number" id="relay-storage-value" min="0.1" max="50" step="0.1" value="1" class="slider-value">
                  <span class="unit-label">GB</span>
                </div>
                <div class="storage-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" id="storage-progress-fill"></div>
                  </div>
                  <span class="progress-text" id="storage-progress-text">0 MB used</span>
                </div>
                <div class="setting-description">Maximum disk space for event storage</div>
              </div>
              
              <div class="setting-item">
                <label for="relay-events">Event Limit</label>
                <div class="slider-input">
                  <input type="range" id="relay-events" min="1000" max="10000000" step="1000" value="100000" class="slider">
                  <input type="number" id="relay-events-value" min="1000" max="10000000" step="1000" value="100000" class="slider-value">
                </div>
                <div class="setting-description">Maximum number of events to store</div>
              </div>
              
              <div class="setting-item">
                <label for="relay-retention">Retention Period</label>
                <div class="slider-input">
                  <input type="range" id="relay-retention" min="1" max="365" value="30" class="slider">
                  <input type="number" id="relay-retention-value" min="1" max="365" value="30" class="slider-value">
                  <span class="unit-label">days</span>
                </div>
                <div class="setting-description">How long to keep events before automatic cleanup</div>
              </div>
            </div>
            
            <!-- Performance Settings -->
            <div class="settings-group collapsible">
              <h3 class="collapsible-header" data-target="performance-settings">
                <span>Performance Settings</span>
                <span class="collapse-indicator">▼</span>
              </h3>
              <div class="collapsible-content" id="performance-settings">
                <div class="setting-item">
                  <label for="relay-max-subs">Max Subscriptions per Connection</label>
                  <div class="slider-input">
                    <input type="range" id="relay-max-subs" min="5" max="100" value="20" class="slider">
                    <input type="number" id="relay-max-subs-value" min="5" max="100" value="20" class="slider-value">
                  </div>
                  <div class="setting-description">Limit subscriptions per WebSocket connection</div>
                </div>
                
                <div class="setting-item">
                  <label for="relay-message-size">Max Message Size</label>
                  <div class="slider-input">
                    <input type="range" id="relay-message-size" min="1" max="10" step="0.1" value="0.5" class="slider">
                    <input type="number" id="relay-message-size-value" min="1" max="10" step="0.1" value="0.5" class="slider-value">
                    <span class="unit-label">MB</span>
                  </div>
                  <div class="setting-description">Maximum size for individual messages</div>
                </div>
                
                <div class="setting-item">
                  <label for="relay-event-size">Max Event Size</label>
                  <div class="slider-input">
                    <input type="range" id="relay-event-size" min="1" max="5" step="0.1" value="0.25" class="slider">
                    <input type="number" id="relay-event-size-value" min="1" max="5" step="0.1" value="0.25" class="slider-value">
                    <span class="unit-label">MB</span>
                  </div>
                  <div class="setting-description">Maximum size for individual events</div>
                </div>
              </div>
            </div>
            
            <!-- Rate Limiting -->
            <div class="settings-group collapsible">
              <h3 class="collapsible-header" data-target="rate-limiting-settings">
                <span>Rate Limiting</span>
                <span class="collapse-indicator">▼</span>
              </h3>
              <div class="collapsible-content" id="rate-limiting-settings">
                <div class="setting-item">
                  <label for="relay-events-per-min">Events per Minute</label>
                  <div class="slider-input">
                    <input type="range" id="relay-events-per-min" min="10" max="1000" value="100" class="slider">
                    <input type="number" id="relay-events-per-min-value" min="10" max="1000" value="100" class="slider-value">
                  </div>
                  <div class="setting-description">Maximum events accepted per minute per connection</div>
                </div>
                
                <div class="setting-item">
                  <label for="relay-req-per-min">Requests per Minute</label>
                  <div class="slider-input">
                    <input type="range" id="relay-req-per-min" min="10" max="600" value="60" class="slider">
                    <input type="number" id="relay-req-per-min-value" min="10" max="600" value="60" class="slider-value">
                  </div>
                  <div class="setting-description">Maximum REQ messages per minute per connection</div>
                </div>
              </div>
            </div>
            
            <!-- Access Control -->
            <div class="settings-group collapsible">
              <h3 class="collapsible-header" data-target="access-control-settings">
                <span>Access Control</span>
                <span class="collapse-indicator">▼</span>
              </h3>
              <div class="collapsible-content" id="access-control-settings">
                <div class="setting-item">
                  <label>
                    <input type="checkbox" id="relay-require-auth">
                    <span>Require authentication</span>
                  </label>
                  <div class="setting-description">Require NIP-42 authentication for connections</div>
                </div>
                
                <div class="setting-item">
                  <label for="relay-allowed-origins">Allowed Origins</label>
                  <div class="list-input">
                    <textarea id="relay-allowed-origins" rows="3" placeholder="https://example.com&#10;https://app.example.com"></textarea>
                    <div class="list-help">One origin per line. Leave empty to allow all origins.</div>
                  </div>
                </div>
                
                <div class="setting-item">
                  <label for="relay-blocked-pubkeys">Blocked Public Keys</label>
                  <div class="list-input">
                    <textarea id="relay-blocked-pubkeys" rows="3" placeholder="npub1... or hex format"></textarea>
                    <div class="list-help">One public key per line (npub or hex format)</div>
                  </div>
                </div>
                
                <div class="setting-item">
                  <label>Allowed Event Kinds</label>
                  <div class="event-kinds-selector">
                    <div class="kinds-presets">
                      <button type="button" class="preset-btn" data-preset="standard">Standard</button>
                      <button type="button" class="preset-btn" data-preset="social">Social</button>
                      <button type="button" class="preset-btn" data-preset="messaging">Messaging</button>
                      <button type="button" class="preset-btn" data-preset="all">All</button>
                      <button type="button" class="preset-btn" data-preset="custom">Custom</button>
                    </div>
                    <div class="kinds-grid" id="event-kinds-grid">
                      <!-- Populated by JavaScript -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Configuration Management -->
            <div class="settings-group">
              <h3>Configuration</h3>
              <div class="setting-item">
                <div class="config-actions">
                  <button type="button" id="relay-restart" class="secondary-button">Restart Relay</button>
                  <button type="button" id="relay-reset-config" class="secondary-button">Reset to Defaults</button>
                  <button type="button" id="relay-export-config" class="secondary-button">Export Config</button>
                  <button type="button" id="relay-import-config" class="secondary-button">Import Config</button>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </section>
      
      <!-- Blossom Section -->
      <section id="blossom" class="settings-section" hidden>
        <h2>Blossom Settings</h2>
        <div class="section-content">
          <div class="setting-item">
            <label>
              <input type="checkbox" id="blossom-enabled">
              <span>Enable Blossom storage</span>
            </label>
          </div>
          
          <div class="blossom-settings" id="blossom-settings">
            <!-- Local Server Configuration -->
            <div class="subsection">
              <h3>Local Server</h3>
              <div class="setting-item">
                <label for="blossom-port">Port:</label>
                <input type="number" id="blossom-port" min="1024" max="65535" value="8088">
                <button id="test-local-blossom" class="secondary-button">Test Connection</button>
              </div>
              
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="blossom-auto-start">
                  <span>Start automatically with browser</span>
                </label>
              </div>
            </div>
            
            <!-- Storage Configuration -->
            <div class="subsection">
              <h3>Storage Configuration</h3>
              <div class="setting-item">
                <label for="blossom-storage-quota">Storage Quota:</label>
                <div class="slider-container">
                  <input type="range" id="blossom-storage-slider" min="1" max="100" value="10">
                  <input type="number" id="blossom-storage-quota" min="1" max="100" value="10">
                  <span>GB</span>
                </div>
              </div>
              
              <div class="setting-item">
                <div class="usage-display">
                  <label>Current Usage:</label>
                  <div class="progress-bar">
                    <div class="progress-fill" id="blossom-usage-bar"></div>
                  </div>
                  <span id="blossom-usage-text">0 MB / 10 GB</span>
                </div>
              </div>
              
              <div class="setting-item">
                <button id="clear-blossom-cache" class="secondary-button">Clear Cache</button>
                <button id="export-blossom-data" class="secondary-button">Export Data</button>
              </div>
            </div>
            
            <!-- Upload Restrictions -->
            <div class="subsection">
              <h3>Upload Restrictions</h3>
              <div class="setting-item">
                <label for="blossom-max-file-size">Max file size (MB):</label>
                <input type="number" id="blossom-max-file-size" min="1" max="5000" value="100">
              </div>
              
              <div class="setting-item">
                <label>Allowed MIME types:</label>
                <div class="mime-type-grid">
                  <label><input type="checkbox" name="mime-type" value="image/*" checked> Images</label>
                  <label><input type="checkbox" name="mime-type" value="video/*" checked> Videos</label>
                  <label><input type="checkbox" name="mime-type" value="audio/*" checked> Audio</label>
                  <label><input type="checkbox" name="mime-type" value="application/pdf"> PDFs</label>
                  <label><input type="checkbox" name="mime-type" value="text/*"> Text files</label>
                  <label><input type="checkbox" name="mime-type" value="application/zip"> Archives</label>
                </div>
                <div class="custom-mime-types">
                  <label for="custom-mime-types">Custom MIME types (one per line):</label>
                  <textarea id="custom-mime-types" rows="3" placeholder="application/json
model/gltf+json"></textarea>
                </div>
              </div>
              
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="blossom-compress-images">
                  <span>Compress images before upload</span>
                </label>
              </div>
            </div>
            
            <!-- Server Management -->
            <div class="subsection">
              <h3>Blossom Servers</h3>
              <p class="help-text">Configure external Blossom servers for content storage and retrieval.</p>
              
              <div class="setting-item">
                <label for="blossom-servers">Server list (one per line):</label>
                <textarea id="blossom-servers" rows="5" placeholder="https://blossom.example.com
https://cdn.example.org/blossom
wss://relay.example.com/blossom"></textarea>
              </div>
              
              <div class="setting-item">
                <button id="test-blossom-servers" class="secondary-button">Test All Servers</button>
                <button id="import-server-list" class="secondary-button">Import from Nostr</button>
              </div>
              
              <div id="blossom-server-status" class="server-status-list"></div>
            </div>
            
            <!-- Mirroring Configuration -->
            <div class="subsection">
              <h3>Content Mirroring</h3>
              <div class="setting-item">
                <label>
                  <input type="checkbox" id="blossom-auto-mirror">
                  <span>Automatically mirror uploads to external servers</span>
                </label>
              </div>
              
              <div class="mirroring-settings" id="mirroring-settings">
                <div class="setting-item">
                  <label for="mirror-redundancy">Redundancy level:</label>
                  <select id="mirror-redundancy">
                    <option value="1">1 server (no redundancy)</option>
                    <option value="2" selected>2 servers</option>
                    <option value="3">3 servers</option>
                    <option value="all">All available servers</option>
                  </select>
                </div>
                
                <div class="setting-item">
                  <label>
                    <input type="checkbox" id="mirror-verify">
                    <span>Verify uploads completed successfully</span>
                  </label>
                </div>
                
                <div class="setting-item">
                  <label for="mirror-retry">Retry failed uploads:</label>
                  <select id="mirror-retry">
                    <option value="0">Don't retry</option>
                    <option value="3" selected>3 attempts</option>
                    <option value="5">5 attempts</option>
                    <option value="10">10 attempts</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Security Section -->
      <section id="security" class="settings-section" hidden>
        <h2>Security</h2>
        <div class="section-content">
          <div class="setting-item">
            <label>
              <input type="checkbox" id="require-password">
              <span>Require password for signing</span>
            </label>
          </div>
          
          <div class="setting-item">
            <label for="key-timeout">Key timeout (minutes):</label>
            <input type="number" id="key-timeout" min="1" max="1440">
          </div>
          
          <div class="setting-item">
            <button id="export-keys" class="secondary-button">Export Keys</button>
            <button id="backup-settings" class="secondary-button">Backup Settings</button>
          </div>
        </div>
      </section>
    </div>
  </div>
  
  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container"></div>
</body>
</html>